{% extends 'website/base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Header do Wizard -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body text-center">
                    <div class="mb-4">
                        <i class="fas fa-magic fa-4x text-primary mb-3"></i>
                        <h1 class="display-5 mb-2">Wizard de Configuração</h1>
                        <p class="lead text-muted">Configure sua empresa em poucos passos simples</p>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="progress mb-4" style="height: 8px;">
                        <div class="progress-bar bg-primary" style="width: {{ progress }}%"></div>
                    </div>
                    
                    <!-- Steps Indicator -->
                    <div class="row mb-4">
                        <div class="col-3">
                            <div class="step-indicator completed">
                                <div class="step-number">✓</div>
                                <div class="step-label">Informações Básicas</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="step-indicator active">
                                <div class="step-number">2</div>
                                <div class="step-label">Personalização</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="step-indicator">
                                <div class="step-number">3</div>
                                <div class="step-label">Configuração</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="step-indicator">
                                <div class="step-number">4</div>
                                <div class="step-label">Usuários</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formulário do Passo 2 -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-palette me-2"></i>
                        Passo 2: Personalização Visual
                    </h5>
                </div>
                <div class="card-body">
                    <form id="wizardForm" onsubmit="salvarPasso2(event)">
                        <!-- Logo da Empresa -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-image me-2"></i>
                                    Logo da Empresa
                                </h6>
                                <div class="logo-upload-area" onclick="document.getElementById('logoInput').click()">
                                    <div class="logo-preview">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                        <p class="mb-2">Clique para fazer upload do logo</p>
                                        <small class="text-muted">PNG, JPG até 2MB</small>
                                    </div>
                                    <input type="file" id="logoInput" accept="image/*" style="display: none;" onchange="previewLogo(event)">
                                </div>
                            </div>
                        </div>

                        <!-- Cores do Sistema -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-palette me-2"></i>
                                    Cores do Sistema
                                </h6>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Cor Principal</label>
                                        <div class="color-picker-wrapper">
                                            <input type="color" class="form-control form-control-color" id="corPrincipal" value="#2196f3">
                                            <span class="color-label">#2196f3</span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Cor Secundária</label>
                                        <div class="color-picker-wrapper">
                                            <input type="color" class="form-control form-control-color" id="corSecundaria" value="#ff9800">
                                            <span class="color-label">#ff9800</span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Cor de Destaque</label>
                                        <div class="color-picker-wrapper">
                                            <input type="color" class="form-control form-control-color" id="corDestaque" value="#4caf50">
                                            <span class="color-label">#4caf50</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tema do Sistema -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-moon me-2"></i>
                                    Tema do Sistema
                                </h6>
                                <div class="theme-options">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="tema" id="temaClaro" value="claro" checked>
                                        <label class="form-check-label" for="temaClaro">
                                            <i class="fas fa-sun text-warning me-2"></i>Claro
                                        </label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="tema" id="temaEscuro" value="escuro">
                                        <label class="form-check-label" for="temaEscuro">
                                            <i class="fas fa-moon text-secondary me-2"></i>Escuro
                                        </label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="tema" id="temaAuto" value="auto">
                                        <label class="form-check-label" for="temaAuto">
                                            <i class="fas fa-magic text-primary me-2"></i>Automático
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-language me-2"></i>
                                    Idioma do Sistema
                                </h6>
                                <select class="form-select" id="idiomaSistema">
                                    <option value="pt-BR" selected>Português (Brasil)</option>
                                    <option value="en-US">English (US)</option>
                                    <option value="es-ES">Español</option>
                                </select>
                            </div>
                        </div>

                        <!-- Preview do Sistema -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-eye me-2"></i>
                                    Preview do Sistema
                                </h6>
                                <div class="preview-container">
                                    <div class="preview-header" id="previewHeader">
                                        <div class="preview-logo" id="previewLogo">
                                            <i class="fas fa-building fa-2x"></i>
                                        </div>
                                        <div class="preview-title">
                                            <h4 id="previewNome">Sua Empresa</h4>
                                            <small id="previewSlogan">Sistema de Gestão</small>
                                        </div>
                                    </div>
                                    <div class="preview-content">
                                        <div class="preview-card">
                                            <div class="preview-card-header">
                                                <i class="fas fa-chart-line"></i>
                                                Dashboard
                                            </div>
                                            <div class="preview-card-body">
                                                <p>Visualize como ficará seu sistema com as configurações escolhidas.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Botões de Navegação -->
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-outline-secondary btn-lg" onclick="voltarPasso()">
                                <i class="fas fa-arrow-left me-2"></i>Voltar
                            </button>
                            <button type="submit" class="btn btn-success btn-lg">
                                Próximo Passo <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.step-indicator {
    text-align: center;
    padding: 10px;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.step-indicator.active {
    background-color: #e8f5e8;
    border: 2px solid #4caf50;
}

.step-indicator.completed {
    background-color: #e3f2fd;
    border: 2px solid #2196f3;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #2196f3;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin: 0 auto 8px;
}

.step-indicator.active .step-number {
    background-color: #4caf50;
}

.step-label {
    font-size: 12px;
    font-weight: 500;
    color: #666;
}

.step-indicator.active .step-label {
    color: #4caf50;
    font-weight: 600;
}

.logo-upload-area {
    border: 2px dashed #ddd;
    border-radius: 10px;
    padding: 40px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.logo-upload-area:hover {
    border-color: #2196f3;
    background-color: #f8f9fa;
}

.color-picker-wrapper {
    display: flex;
    align-items: center;
    gap: 10px;
}

.color-picker-wrapper input[type="color"] {
    width: 60px;
    height: 40px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.color-label {
    font-family: monospace;
    font-weight: bold;
    color: #666;
}

.preview-container {
    border: 1px solid #ddd;
    border-radius: 10px;
    overflow: hidden;
    background: white;
}

.preview-header {
    background: linear-gradient(135deg, #2196f3, #1976d2);
    color: white;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.preview-content {
    padding: 20px;
}

.preview-card {
    border: 1px solid #eee;
    border-radius: 8px;
    overflow: hidden;
}

.preview-card-header {
    background-color: #f8f9fa;
    padding: 15px;
    font-weight: 600;
    border-bottom: 1px solid #eee;
}

.preview-card-body {
    padding: 15px;
}

.btn-lg {
    padding: 12px 24px;
    font-size: 1.1rem;
}
</style>

<script>
function previewLogo(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const logoPreview = document.getElementById('previewLogo');
            logoPreview.innerHTML = `<img src="${e.target.result}" style="max-width: 60px; max-height: 60px; object-fit: contain;">`;
        };
        reader.readAsDataURL(file);
    }
}

function salvarPasso2(event) {
    event.preventDefault();
    
    // Salvar dados no localStorage
    const dadosPersonalizacao = {
        corPrincipal: document.getElementById('corPrincipal').value,
        corSecundaria: document.getElementById('corSecundaria').value,
        corDestaque: document.getElementById('corDestaque').value,
        tema: document.querySelector('input[name="tema"]:checked').value,
        idioma: document.getElementById('idiomaSistema').value
    };
    
    localStorage.setItem('wizard_personalizacao', JSON.stringify(dadosPersonalizacao));
    
    // Mostrar loading e ir para próximo passo
    Swal.fire({
        title: 'Salvando...',
        text: 'Salvando personalização visual',
        icon: 'info',
        showConfirmButton: false,
        timer: 1500
    }).then(() => {
        window.location.href = '/sistema/wizard/?step=3';
    });
}

function voltarPasso() {
    window.location.href = '/sistema/wizard/?step=1';
}

// Atualizar preview quando cores mudarem
document.addEventListener('DOMContentLoaded', function() {
    const corPrincipal = document.getElementById('corPrincipal');
    const corSecundaria = document.getElementById('corSecundaria');
    const corDestaque = document.getElementById('corDestaque');
    
    function atualizarPreview() {
        const header = document.getElementById('previewHeader');
        header.style.background = `linear-gradient(135deg, ${corPrincipal.value}, ${corSecundaria.value})`;
    }
    
    corPrincipal.addEventListener('change', atualizarPreview);
    corSecundaria.addEventListener('change', atualizarPreview);
    
    // Carregar dados salvos
    const dadosEmpresa = JSON.parse(localStorage.getItem('wizard_empresa') || '{}');
    if (dadosEmpresa.nome) {
        document.getElementById('previewNome').textContent = dadosEmpresa.nome;
    }
});

// Incluir SweetAlert2
if (typeof Swal === 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/sweetalert2@11';
    document.head.appendChild(script);
}
</script>
{% endblock %} 