{% extends "admin/base_site.html" %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            background: #181818 !important;
            color: #fff !important;
        }
        #toggle-nav-sidebar { display: none !important; }
        .iphone-sidebar {
            position: fixed;
            top: 120px;
            left: 0;
            width: 180px;
            height: calc(100vh - 120px);
            background: #23272e;
            box-shadow: 2px 0 12px #0001;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 3.5em;
        }
        .iphone-menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.1em 0.7em;
            justify-items: center;
        }
        .iphone-tile {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #23272e 60%, #444950 100%);
            border-radius: 20px;
            box-shadow: 0 4px 16px #0002, 0 1.5px 0 #fff8 inset;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: box-shadow 0.15s, transform 0.1s;
            position: relative;
            cursor: pointer;
        }
        .iphone-tile:active {
            box-shadow: 0 2px 8px #0003;
            transform: scale(0.96);
        }
        .iphone-tile .fa {
            font-size: 1.7em;
            margin-bottom: 0.2em;
        }
        .iphone-tile span {
            font-size: 0.85em;
            color: #fff;
            font-weight: 500;
            text-align: center;
            white-space: normal;
        }
        .icon-users { color: #007aff; }
        .icon-building { color: #ff9500; }
        .icon-box { color: #34c759; }
        .icon-store { color: #af52de; }
        .icon-file-invoice { color: #ff2d55; }
        .icon-cubes { color: #5ac8fa; }
        .icon-exchange { color: #ffcc00; }
        .icon-user-shield { color: #5856d6; }
        .icon-cash-register { color: #ff3b30; }
        .icon-dashboard { color: #4cd964; }
        .icon-list { color: #ffb300; }
        .icon-check { color: #00b894; }
        .icon-mic { color: #e84393; }
        #nav-sidebar { display: none !important; }
        .main.shifted {
            margin-left: 200px !important;
            margin-top: 20px !important;
        }
        /* Submenu Ordens de Serviço */
        .os-dropdown {
            position: relative;
        }
        .os-dropdown-content {
            display: none;
            position: absolute;
            left: 80px;
            top: 0;
            min-width: 160px;
            background: #23272e;
            box-shadow: 0 4px 16px #0002;
            border-radius: 12px;
            padding: 0.5em 0.5em 0.5em 0.5em;
            z-index: 100;
        }
        .os-dropdown:hover .os-dropdown-content,
        .os-dropdown:focus-within .os-dropdown-content {
            display: block;
        }
        .os-dropdown-link {
            display: flex;
            align-items: center;
            gap: 0.7em;
            padding: 0.5em 0.7em;
            border-radius: 8px;
            color: #fff !important;
            text-decoration: none;
            font-size: 1em;
            margin-bottom: 0.2em;
            transition: background 0.15s, color 0.15s;
        }
        .os-dropdown-link:hover {
            background: #444950;
            color: #fff !important;
        }
        .os-dropdown-link .fa { font-size: 1.1em; }
        @media (max-width: 900px) {
            .iphone-sidebar {
                position: static;
                width: 100vw;
                height: auto;
                box-shadow: none;
                flex-direction: column;
                align-items: center;
                padding: 1.5em 0 1.5em 0;
                background: #23272e;
                overflow-x: visible;
                overflow-y: auto;
                z-index: 100;
                top: 0;
                height: auto;
            }
            .iphone-menu-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(4, 1fr);
                gap: 1.2em;
                width: 100%;
                max-width: 380px;
                margin: 0 auto;
                justify-items: center;
                align-items: center;
            }
            .iphone-tile {
                width: 80px;
                height: 80px;
                min-width: 80px;
                min-height: 80px;
                font-size: 1em;
            }
            .iphone-tile .fa { font-size: 2.2em; }
            .iphone-tile span { font-size: 1em; }
            .main.shifted { margin-left: 0 !important; margin-top: 0 !important; }
            .os-dropdown-content { left: 0; top: 70px; min-width: 140px; }
        }
        @media (max-width: 600px) {
            .iphone-tile {
                width: 64px;
                height: 64px;
                min-width: 64px;
                min-height: 64px;
                font-size: 0.95em;
            }
            .iphone-tile .fa { font-size: 1.5em; }
            .iphone-tile span { font-size: 0.85em; }
        }
    </style>
    <script>
    window.addEventListener('DOMContentLoaded', function() {
        var main = document.querySelector('.main');
        if (main) main.classList.add('shifted');
        var micBtn = document.getElementById('mic-tile');
        if (micBtn) {
            micBtn.onclick = function(e) {
                e.preventDefault();
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'pt-BR';
                recognition.start();
                recognition.onresult = function(event) {
                    const comando = event.results[0][0].transcript;
                    alert('Você disse: ' + comando);
                };
            };
        }
    });
    </script>
{% endblock %}

{% block sidebar %}
    <div class="iphone-sidebar">
        <div class="iphone-menu-grid">
            <a href="/sistema/" class="iphone-tile" title="Dashboard"><i class="fas fa-chart-pie icon-dashboard"></i><span>Dashboard</span></a>
            <a href="{% url 'admin:auth_user_changelist' %}" class="iphone-tile" title="Usuários"><i class="fas fa-users icon-users"></i><span>Usuários</span></a>
            <a href="{% url 'admin:empresas_empresa_changelist' %}" class="iphone-tile" title="Empresas"><i class="fas fa-building icon-building"></i><span>Empresas</span></a>
            <a href="{% url 'admin:estoque_estoque_changelist' %}" class="iphone-tile" title="Estoque"><i class="fas fa-box icon-box"></i><span>Estoque</span></a>
            <a href="{% url 'admin:lojas_loja_changelist' %}" class="iphone-tile" title="Lojas"><i class="fas fa-store icon-store"></i><span>Lojas</span></a>
            <a href="{% url 'admin:nfe_nfe_changelist' %}" class="iphone-tile" title="NFe"><i class="fas fa-file-invoice icon-file-invoice"></i><span>NFe</span></a>
            <a href="{% url 'admin:produtos_produto_changelist' %}" class="iphone-tile" title="Produtos"><i class="fas fa-cubes icon-cubes"></i><span>Produtos</span></a>
            <a href="{% url 'admin:transferencias_transferenciaestoque_changelist' %}" class="iphone-tile" title="Transferências"><i class="fas fa-exchange-alt icon-exchange"></i><span>Transferências</span></a>
            <a href="{% url 'admin:vendas_venda_changelist' %}" class="iphone-tile" title="Vendas"><i class="fas fa-shopping-cart icon-cash-register"></i><span>Vendas</span></a>
            <a href="/sistema/financeiro/" class="iphone-tile" title="Financeiro"><i class="fas fa-money-bill-wave icon-cash-register"></i><span>Financeiro</span></a>
            <a href="/relatorios/" class="iphone-tile" title="Relatórios"><i class="fas fa-chart-bar icon-dashboard"></i><span>Relatórios</span></a>
            <a href="/consignados/" class="iphone-tile" title="Consignados"><i class="fas fa-handshake icon-cash-register"></i><span>Consignados</span></a>
            <div class="os-dropdown iphone-tile" tabindex="0" title="Ordens de Serviço">
                <i class="fas fa-list icon-list"></i><span>Ordens Serviço</span>
                <div class="os-dropdown-content">
                    <a href="{% url 'admin:ordens_servico_ordemservico_changelist' %}" class="os-dropdown-link"><i class="fas fa-list icon-list"></i> Ordens de Serviço</a>
                    <a href="{% url 'admin:ordens_servico_itemordemservico_changelist' %}" class="os-dropdown-link"><i class="fas fa-cubes icon-cubes"></i> Itens OS</a>
                    <a href="{% url 'admin:ordens_servico_checklistordemservico_changelist' %}" class="os-dropdown-link"><i class="fas fa-check icon-check"></i> Checklists OS</a>
                </div>
            </div>
            <a href="#" id="mic-tile" class="iphone-tile" title="Comando de Voz"><i class="fas fa-microphone icon-mic"></i><span>Voz</span></a>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div style="float:right; width: 40%; min-width: 320px; margin-left: 2em;">
        <div class="dashboard-container" style="max-width:100%;margin:0 0 2rem 0;padding:2rem;background:#fff;border-radius:10px;box-shadow:0 2px 8px #0001;">
            <h2 class="dashboard-title" style="text-align:center;margin-bottom:2rem;">Dashboard Resumido</h2>
            <div class="dashboard-cards" style="display:flex;gap:2rem;justify-content:center;margin-bottom:2rem;">
                <div class="dashboard-card" style="background:#f5f5f5;padding:1.5rem 2rem;border-radius:8px;text-align:center;font-size:1.2rem;box-shadow:0 1px 4px #0001;">Ordens de Serviço<br><b>{{ total_os|default:'-' }}</b></div>
                <div class="dashboard-card" style="background:#f5f5f5;padding:1.5rem 2rem;border-radius:8px;text-align:center;font-size:1.2rem;box-shadow:0 1px 4px #0001;">Clientes<br><b>{{ total_clientes|default:'-' }}</b></div>
                <div class="dashboard-card" style="background:#f5f5f5;padding:1.5rem 2rem;border-radius:8px;text-align:center;font-size:1.2rem;box-shadow:0 1px 4px #0001;">Vendas<br><b>{{ total_vendas|default:'-' }}</b></div>
            </div>
            <canvas id="graficoResumo" height="100"></canvas>
        </div>
    </div>
    {{ block.super }}
{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    window.addEventListener('DOMContentLoaded', function() {
        // Gráfico Chart.js
        const ctx = document.getElementById('graficoResumo');
        if (ctx) {
            new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Ordens de Serviço', 'Clientes', 'Vendas'],
                    datasets: [{
                        label: 'Totais',
                        data: [
                            parseInt('{{ total_os|default:0 }}'),
                            parseInt('{{ total_clientes|default:0 }}'),
                            parseInt('{{ total_vendas|default:0 }}')
                        ],
                        backgroundColor: ['#4caf50', '#2196f3', '#ff9800'],
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });
        }
    });
    </script>
{% endblock %} 